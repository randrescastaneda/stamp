<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with Partitioned Datasets • stamp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with Partitioned Datasets">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stamp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/stamp.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/setup-and-basics.html">Setup and Basics</a></li>
    <li><a class="dropdown-item" href="../articles/stamp-directory.html">The .stamp Directory: Structure and Internals</a></li>
    <li><a class="dropdown-item" href="../articles/hashing-and-versions.html">Hashing, Change Detection and Versions</a></li>
    <li><a class="dropdown-item" href="../articles/lineage-rebuilds.html">Lineage and Rebuilds</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Usage</h6></li>
    <li><a class="dropdown-item" href="../articles/builders-plans.html">Builders, Plans, and Rebuilds</a></li>
    <li><a class="dropdown-item" href="../articles/using-alias.html">Using Aliases with stamp</a></li>
    <li><a class="dropdown-item" href="../articles/version_retention_prune.html">Version Retention, Pruning, and Table Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/partitions.html">Working with Partitioned Datasets</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/randrescastaneda/stamp"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with Partitioned Datasets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/randrescastaneda/stamp/blob/master/vignettes/partitions.Rmd" class="external-link"><code>vignettes/partitions.Rmd</code></a></small>
      <div class="d-none name"><code>partitions.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates stamp’s partitioning system for managing
large datasets split across multiple files using Hive-style directory
structures. Partitioning is ideal for:</p>
<ul>
<li>
<strong>Large datasets</strong> that need to be split by country,
year, region, etc.</li>
<li>
<strong>Selective loading</strong> where you only need specific
subsets (e.g., one country’s data)</li>
<li>
<strong>Columnar efficiency</strong> when using parquet/fst formats
(load only needed columns)</li>
<li>
<strong>Parallel processing</strong> where partitions can be
proceEssed independently</li>
</ul>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize stamp</span></span>
<span><span class="va">tdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"stamp-partitions-"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tdir</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/st_init.html">st_init</a></span><span class="op">(</span><span class="va">tdir</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> stamp initialized</span></span>
<span><span class="co">#&gt;   alias: default</span></span>
<span><span class="co">#&gt;   root: /tmp/RtmpANskQE/stamp-partitions-21124c49c0ea</span></span>
<span><span class="co">#&gt;   state: /tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/.stamp</span></span>
<span></span>
<span><span class="co"># Create sample welfare data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># for reproducible vignette output</span></span>
<span><span class="va">welfare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"CAN"</span>, <span class="st">"MEX"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">:</span><span class="fl">2024</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>  reporting_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"national"</span>, <span class="st">"urban"</span>, <span class="st">"rural"</span><span class="op">)</span>,</span>
<span>    <span class="fl">300</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  hh_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">300</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">50000</span>, <span class="fl">15000</span><span class="op">)</span>,</span>
<span>  consumption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">35000</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Auto-partition and save (eliminates manual looping!)</span></span>
<span><span class="va">parts_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"welfare_parts"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">welfare</span>,</span>
<span>  base <span class="op">=</span> <span class="va">parts_dir</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span><span class="op">)</span>,</span>
<span>  code_label <span class="op">=</span> <span class="st">"welfare_data"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">77ea8378746818d6</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">63f20cd8773e93fa</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">ba9f07dd5b894dfc</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">873401efb138f4a4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">feca7fcb88ed67a1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">3c350949105705df</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">c5eeb13fb84587f6</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">d2302c312af08d54</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">94a5888ae2348fa8</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">f38eef03fbbdff34</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">3c9e23ccab1c9f8b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">2ef895d405892fce</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">070d38f35d396699</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">a3185faf7458387b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">f80cb6bb0fcbb827</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">eac06aff4ff07dc2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">569e529a44933c2e</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">7718182dd3319dfb</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">06b1275ee2e26c10</span></span></span>
<span><span class="co">#&gt; ⠙ Saving 19/45 partitions [1s]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">ac8aa3656f48bd84</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">c4388a39517469ff</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">5c51393989d744dd</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">4bc5fb72192f266e</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">428585cade87873b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">e112c457a52186d9</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">2e39c04a13094e21</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">fd5b79f6a7c091fc</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">a3e16b73afbadadb</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">998f4581a1a3efde</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8d2d58410220a123</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">4cc3f9f1c5f7e151</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">b8090000e27c445b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">716f01121d4d5a90</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">4d70fcd8a13cf4ea</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">732333230053e7b9</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">fdc8928dd69d66df</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">d879817064cf8442</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">e94dadfc1e93013d</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">e747f7b668eedcc6</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">9357f4efa92e4821</span></span></span>
<span><span class="co">#&gt; ⠹ Saving 40/45 partitions [2s]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">d1c6dabf692bf1e2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8fb1cfb3e3901b4e</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">807e24c6aa5624c5</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">5c597bb1976aa903</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">25f78fd9137a8cf3</span></span></span>
<span><span class="co">#&gt; ⠹ Saving 45/45 partitions [2.2s]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 45 partitions to</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts</span></span></span>
<span></span>
<span><span class="co"># View manifest</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">manifest</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   partition_key</span></span>
<span><span class="co">#&gt; 1  USA, 202....</span></span>
<span><span class="co">#&gt; 2  USA, 202....</span></span>
<span><span class="co">#&gt; 3  USA, 202....</span></span>
<span><span class="co">#&gt;                                                                                                                   path</span></span>
<span><span class="co">#&gt; 1 /tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span></span>
<span><span class="co">#&gt; 2 /tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span></span>
<span><span class="co">#&gt; 3 /tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span>
<span><span class="co">#&gt;         version_id n_rows</span></span>
<span><span class="co">#&gt; 1 77ea8378746818d6      3</span></span>
<span><span class="co">#&gt; 2 63f20cd8773e93fa      9</span></span>
<span><span class="co">#&gt; 3 ba9f07dd5b894dfc     10</span></span></code></pre></div>
<p>The manifest shows: - <code>partition_key</code>: List of key-value
pairs for each partition - <code>path</code>: File location with
Hive-style structure - <code>version_id</code>: Version identifier for
tracking - <code>n_rows</code>: Number of rows in partition</p>
</div>
<div class="section level2">
<h2 id="hive-style-partitioning">Hive-Style Partitioning<a class="anchor" aria-label="anchor" href="#hive-style-partitioning"></a>
</h2>
<p>Partitions are organized in directories following the Hive
convention:</p>
<pre><code><span><span class="va">base_dir</span><span class="op">/</span></span>
<span>  <span class="va">key1</span><span class="op">=</span><span class="va">value1</span><span class="op">/</span></span>
<span>    <span class="va">key2</span><span class="op">=</span><span class="va">value2</span><span class="op">/</span></span>
<span>      <span class="va">part.parquet</span></span></code></pre>
<p>For example:</p>
<pre><code><span><span class="va">welfare_parts</span><span class="op">/</span></span>
<span>  <span class="va">country</span><span class="op">=</span><span class="va">USA</span><span class="op">/</span></span>
<span>    <span class="va">year</span><span class="op">=</span><span class="fl">2020</span><span class="op">/</span></span>
<span>      <span class="va">reporting_level</span><span class="op">=</span><span class="va">national</span><span class="op">/</span></span>
<span>        <span class="va">part.parquet</span></span>
<span>      <span class="va">reporting_level</span><span class="op">=</span><span class="va">urban</span><span class="op">/</span></span>
<span>        <span class="va">part.parquet</span></span></code></pre>
<p>This structure: - <strong>Self-documenting</strong>: Directory names
encode partition values - <strong>Efficient discovery</strong>: Tools
can scan directory structure to find partitions - <strong>Standard
format</strong>: Compatible with Apache Spark, Apache Arrow, DuckDB,
etc.</p>
</div>
<div class="section level2">
<h2 id="auto-partitioning-with-st_write_parts">Auto-Partitioning with <code>st_write_parts()</code><a class="anchor" aria-label="anchor" href="#auto-partitioning-with-st_write_parts"></a>
</h2>
<p>Before <code><a href="../reference/st_write_parts.html">st_write_parts()</a></code>, you had to manually loop
through partition combinations:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ❌ OLD WAY - Manual looping (verbose, error-prone)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ctry</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">welfare</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">yr</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">welfare</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">rl</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">welfare</span><span class="op">$</span><span class="va">reporting_level</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">part_dt</span> <span class="op">&lt;-</span> <span class="va">welfare</span><span class="op">[</span><span class="va">country</span> <span class="op">==</span> <span class="va">ctry</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">==</span> <span class="va">yr</span> <span class="op">&amp;</span> <span class="va">reporting_level</span> <span class="op">==</span> <span class="va">rl</span><span class="op">]</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">part_dt</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/st_save_part.html">st_save_part</a></span><span class="op">(</span></span>
<span>          <span class="va">part_dt</span>,</span>
<span>          base <span class="op">=</span> <span class="va">parts_dir</span>,</span>
<span>          key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>country <span class="op">=</span> <span class="va">ctry</span>, year <span class="op">=</span> <span class="va">yr</span>, reporting_level <span class="op">=</span> <span class="va">rl</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now it’s a single function call:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ✅ NEW WAY - Auto-partitioning (clean, efficient)</span></span>
<span><span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">welfare</span>,</span>
<span>  base <span class="op">=</span> <span class="va">parts_dir</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span><span class="op">)</span>,</span>
<span>  code_label <span class="op">=</span> <span class="st">"welfare_data"</span>,</span>
<span>  .progress <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Disable progress bar for vignette</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">9398410672fde3d4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">077558c592b4b4ea</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">b146d44b6b422f72</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8a33a1070585f721</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">4ae6779603270897</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">34ddc16630085330</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">1feaf21403ba9832</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">0af2c3fcf5daf1b3</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">e0edd1bb9902f021</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">e4324a1ef7ad342f</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">203ad559c7f952d4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">d2f8a69edd87abb4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">39489e36137f162b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">0d9ddaf84b60c131</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">445db238fa69e952</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">bf932629d96914da</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">5d076b8a09fa25fd</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">c995365f041a5405</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">668adb107692d5f1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">72538a691bf31746</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">dcea32989c8b4bd8</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">4830896e670dcd42</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">53f112f48ab9f2c3</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">fc54f310f2933f00</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">53ad90a2dddb5aa1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">70b0f9de4e50c1b0</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">3dbdfe87dae79ae1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">b4adcec24dcd5eb5</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">fc833a481432734a</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">11ec84d3ae057785</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">ec8bf5c520f41a29</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">091122b724c6b08a</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">f787c7e02683e5a9</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">c680ac921f9ef6a4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">01172c7c90b134b2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">b7029a895e7ac5c0</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8cf6087b736d0955</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">9127f63505e99fd0</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8900515824e70517</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">a7195a3f2cf23e36</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">e2c5364e5e67e372</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">78bf95b83ebdf11b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">6b93f8b13ba13b6e</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">c6cd4885e57278d9</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">701d098ee26b0f52</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 45 partitions to</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts</span></span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Saved %d partitions\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">manifest</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Saved 45 partitions</span></span></code></pre></div>
<div class="section level3">
<h3 id="benefits">Benefits<a class="anchor" aria-label="anchor" href="#benefits"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Automatic splitting</strong>: Handles all combinations of
partition values</li>
<li>
<strong>Progress tracking</strong>: Shows progress bar for many
partitions (&gt;10 by default)</li>
<li>
<strong>Error handling</strong>: Gracefully handles failed
partitions</li>
<li>
<strong>Consistent metadata</strong>: All partitions get same
code_label, versioning</li>
<li>
<strong>Performance</strong>: Uses <code><a href="https://rdrr.io/pkg/data.table/man/split.html" class="external-link">data.table::split()</a></code>
when available for speed</li>
</ol>
</div>
<div class="section level3">
<h3 id="format-selection">Format Selection<a class="anchor" aria-label="anchor" href="#format-selection"></a>
</h3>
<p>By default, <code><a href="../reference/st_write_parts.html">st_write_parts()</a></code> uses
<strong>parquet</strong> format for optimal columnar performance:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default format is parquet</span></span>
<span><span class="va">format_manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">welfare</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span>,</span>
<span>  base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test_format"</span><span class="op">)</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  .progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/test_format/country=USA/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8c7d0a8f74872759</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 1 partition to</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/test_format</span></span></span>
<span></span>
<span><span class="co"># Check file extension</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">format_manifest</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "part.parquet"</span></span></code></pre></div>
<p>Override with explicit format:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use fst format instead</span></span>
<span><span class="va">manifest_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">welfare</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span>,</span>
<span>  base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test_fst"</span><span class="op">)</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"fst"</span>,</span>
<span>  .progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">fst</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/test_fst/country=USA/part.fst</span> @</span></span>
<span><span class="co">#&gt;   version <span style="color: #00BB00;">668998730292ffa1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 1 partition to <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/test_fst</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">manifest_fst</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "part.fst"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="loading-partitions">Loading Partitions<a class="anchor" aria-label="anchor" href="#loading-partitions"></a>
</h2>
<div class="section level3">
<h3 id="load-all-partitions">Load All Partitions<a class="anchor" aria-label="anchor" href="#load-all-partitions"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load all partitions and row-bind</span></span>
<span><span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span><span class="va">parts_dir</span>, as <span class="op">=</span> <span class="st">"dt"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Loaded %d rows from %d partitions\n"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">all_data</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">manifest</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded 300 rows from 45 partitions</span></span>
<span></span>
<span><span class="co"># Partition columns are automatically added</span></span>
<span><span class="co"># Show first few rows with selected columns (only if they exist)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">all_data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cols_to_show</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span>, <span class="st">"hh_id"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">all_data</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols_to_show</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_data</span><span class="op">[</span>, <span class="va">..cols_to_show</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_data</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"No data loaded"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;    country   year reporting_level hh_id   income</span></span>
<span><span class="co">#&gt;     &lt;char&gt; &lt;char&gt;          &lt;char&gt; &lt;int&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     CAN   2020        national   106 53133.61</span></span>
<span><span class="co">#&gt; 2:     CAN   2020        national   116 45187.54</span></span>
<span><span class="co">#&gt; 3:     CAN   2020        national   141 44242.25</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exact-match-filtering-named-list">Exact Match Filtering (Named List)<a class="anchor" aria-label="anchor" href="#exact-match-filtering-named-list"></a>
</h3>
<p>Use a named list for exact equality matching (backward compatible).
Note: character partition values are normalized to lowercase in paths
and loaded data. Match using lowercase or use case-insensitive
formulas.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load only USA data</span></span>
<span><span class="va">usa_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"usa"</span><span class="op">)</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"USA data: %d rows\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">usa_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; USA data: 0 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">usa_data</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multiple exact matches (AND logic)</span></span>
<span><span class="va">usa_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"usa"</span>, year <span class="op">=</span> <span class="st">"2020"</span><span class="op">)</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"USA 2020: %d rows\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">usa_2020</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; USA 2020: 0 rows</span></span>
<span><span class="co"># Show unique values for partition columns (only if they exist)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">usa_2020</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cols_to_show</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usa_2020</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols_to_show</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">usa_2020</span><span class="op">[</span>, <span class="va">..cols_to_show</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Notice it is possible to use the numeric string “2020”. See <a href="#filter-expression-capabilities">Filter Expression
Capabilities</a> below for clarification.</p>
</div>
<div class="section level3">
<h3 id="expression-based-filtering-formula">Expression-Based Filtering (Formula)<a class="anchor" aria-label="anchor" href="#expression-based-filtering-formula"></a>
</h3>
<p>For flexible filtering with comparisons and boolean logic, use
formula syntax:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data where year &gt; 2021 (numeric comparison)</span></span>
<span><span class="va">recent_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2021</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Recent data (year &gt; 2021): %d rows\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Recent data (year &gt; 2021): 180 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2022 2023 2024 </span></span>
<span><span class="co">#&gt;   60   60   60</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Complex boolean logic: (country == "usa" AND year &gt;= 2023) OR (country == "can" AND year == 2020)</span></span>
<span><span class="va">complex_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">==</span> <span class="st">"usa"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2023</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">==</span> <span class="st">"can"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Complex filter: %d rows\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">complex_filter</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Complex filter: 60 rows</span></span>
<span><span class="co"># Check if country/year columns exist before using them</span></span>
<span><span class="va">cols_to_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">complex_filter</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols_to_group</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">complex_filter</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols_to_group</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">cols_to_group</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;    country   year     N</span></span>
<span><span class="co">#&gt;     &lt;char&gt; &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     CAN   2020    20</span></span>
<span><span class="co">#&gt; 2:     USA   2023    20</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use %in% for multiple values</span></span>
<span><span class="va">selected_countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"usa"</span>, <span class="st">"mex"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">!=</span> <span class="fl">2020</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"USA/MEX (not 2020): %d rows\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">selected_countries</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; USA/MEX (not 2020): 160 rows</span></span>
<span><span class="co"># Check if country column exists before using it</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"country"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">selected_countries</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">selected_countries</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="va">country</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;    country     N</span></span>
<span><span class="co">#&gt;     &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     MEX    80</span></span>
<span><span class="co">#&gt; 2:     USA    80</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filter-expression-capabilities">Filter Expression Capabilities<a class="anchor" aria-label="anchor" href="#filter-expression-capabilities"></a>
</h3>
<p>Formula filters support:</p>
<ul>
<li>
<strong>Comparisons</strong>: <code>&gt;</code>, <code>&lt;</code>,
<code>&gt;=</code>, <code>&lt;=</code>, <code>==</code>,
<code>!=</code>
</li>
<li>
<strong>Boolean logic</strong>: <code>&amp;</code> (AND),
<code>|</code> (OR), <code>!</code> (NOT)</li>
<li>
<strong>Set operations</strong>: <code>%in%</code>,
<code>%nin%</code> (if defined)</li>
<li>
<strong>Parentheses</strong>: For grouping complex logic</li>
<li>
<strong>Type conversion</strong>: Automatic for numeric partition
keys</li>
</ul>
<p><strong>Important</strong>: Partition keys are automatically
type-converted: - Numeric strings (<code>"2020"</code>) → numeric
(<code>2020</code>) - Boolean strings (<code>"TRUE"</code>) → logical
(<code>TRUE</code>) - Other strings remain strings</p>
</div>
</div>
<div class="section level2">
<h2 id="columnar-loading-column-selection">Columnar Loading (Column Selection)<a class="anchor" aria-label="anchor" href="#columnar-loading-column-selection"></a>
</h2>
<p>When using parquet or fst formats, you can load only specific columns
for massive performance gains:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load only income column (+ partition keys automatically included)</span></span>
<span><span class="va">income_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span><span class="op">)</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">income_only</span><span class="op">)</span> <span class="co"># May include partition keys (country, year, reporting_level) if available</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<div class="section level3">
<h3 id="native-vs--fallback-column-selection">Native vs. Fallback Column Selection<a class="anchor" aria-label="anchor" href="#native-vs--fallback-column-selection"></a>
</h3>
<table class="table">
<colgroup>
<col width="27%">
<col width="44%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Format</th>
<th>Native Support</th>
<th>Behavior</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>parquet</td>
<td>✅ Yes</td>
<td>Fast - reads only specified columns from disk</td>
</tr>
<tr class="even">
<td>fst</td>
<td>✅ Yes</td>
<td>Fast - reads only specified columns from disk</td>
</tr>
<tr class="odd">
<td>qs/qs2</td>
<td>❌ No</td>
<td>Loads full object, then subsets (with warning)</td>
</tr>
<tr class="even">
<td>rds</td>
<td>❌ No</td>
<td>Loads full object, then subsets (with warning)</td>
</tr>
<tr class="odd">
<td>csv</td>
<td>❌ No</td>
<td>Loads full object, then subsets (with warning)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parquet: native column selection (efficient)</span></span>
<span><span class="va">parquet_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hh_id"</span>, <span class="st">"income"</span><span class="op">)</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Columns loaded:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">parquet_cols</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Columns loaded:</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="combining-filters-and-column-selection">Combining Filters and Column Selection<a class="anchor" aria-label="anchor" href="#combining-filters-and-column-selection"></a>
</h3>
<p>The real power comes from combining both:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load recent USA data, only income and consumption columns</span></span>
<span><span class="va">usa_recent_finance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">==</span> <span class="st">"usa"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2022</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"consumption"</span><span class="op">)</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Loaded %d rows × %d columns\n"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">usa_recent_finance</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">usa_recent_finance</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded 0 rows × 0 columns</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">usa_recent_finance</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Null data.table (0 rows and 0 cols)</span></span></code></pre></div>
<p>This approach: 1. <strong>Filters partitions</strong> before reading
(only loads relevant files) 2. <strong>Reads only needed
columns</strong> from those files (with parquet/fst) 3.
<strong>Minimizes memory</strong> and I/O for large datasets</p>
</div>
</div>
<div class="section level2">
<h2 id="discovering-partitions-with-st_list_parts">Discovering Partitions with <code>st_list_parts()</code><a class="anchor" aria-label="anchor" href="#discovering-partitions-with-st_list_parts"></a>
</h2>
<p>List available partitions without loading data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List all partitions</span></span>
<span><span class="va">all_partitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_list_parts.html">st_list_parts</a></span><span class="op">(</span><span class="va">parts_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Found %d partitions\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">all_partitions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found 45 partitions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_partitions</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt;   country year reporting_level</span></span>
<span><span class="co">#&gt; 1     CAN 2020        national</span></span>
<span><span class="co">#&gt; 2     CAN 2021        national</span></span>
<span><span class="co">#&gt; 3     CAN 2022        national</span></span>
<span><span class="co">#&gt; 4     CAN 2023        national</span></span>
<span><span class="co">#&gt; 5     CAN 2024        national</span></span>
<span><span class="co">#&gt; 6     CAN 2020           rural</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List specific partitions with filter</span></span>
<span><span class="va">mexico_partitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_list_parts.html">st_list_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">==</span> <span class="st">"mex"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2022</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Mexico (2022+): %d partitions\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mexico_partitions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mexico (2022+): 9 partitions</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mexico_partitions</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mexico_partitions</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Return an empty data.frame with expected columns to avoid subsetting errors</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, reporting_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   country year reporting_level</span></span>
<span><span class="co">#&gt; 1     MEX 2022        national</span></span>
<span><span class="co">#&gt; 2     MEX 2023        national</span></span>
<span><span class="co">#&gt; 3     MEX 2024        national</span></span>
<span><span class="co">#&gt; 4     MEX 2022           rural</span></span>
<span><span class="co">#&gt; 5     MEX 2023           rural</span></span>
<span><span class="co">#&gt; 6     MEX 2024           rural</span></span>
<span><span class="co">#&gt; 7     MEX 2022           urban</span></span>
<span><span class="co">#&gt; 8     MEX 2023           urban</span></span>
<span><span class="co">#&gt; 9     MEX 2024           urban</span></span></code></pre></div>
<p>Use cases: - <strong>Inventory check</strong>: What partitions exist?
- <strong>Validation</strong>: Ensure expected partitions were created -
<strong>Selective processing</strong>: Get file paths for external
processing - <strong>Metadata extraction</strong>: Extract partition
values without loading data</p>
</div>
<div class="section level2">
<h2 id="single-partition-operations">Single Partition Operations<a class="anchor" aria-label="anchor" href="#single-partition-operations"></a>
</h2>
<p>For fine-grained control, use <code><a href="../reference/st_save_part.html">st_save_part()</a></code> and
<code><a href="../reference/st_part_path.html">st_part_path()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save a single partition explicitly</span></span>
<span><span class="va">single_partition</span> <span class="op">&lt;-</span> <span class="va">welfare</span><span class="op">[</span></span>
<span>  <span class="va">country</span> <span class="op">==</span> <span class="st">"USA"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">==</span> <span class="fl">2024</span> <span class="op">&amp;</span> <span class="va">reporting_level</span> <span class="op">==</span> <span class="st">"urban"</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/st_save_part.html">st_save_part</a></span><span class="op">(</span></span>
<span>  <span class="va">single_partition</span>,</span>
<span>  base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"manual_parts"</span><span class="op">)</span>,</span>
<span>  key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"USA"</span>, year <span class="op">=</span> <span class="fl">2024</span>, reporting_level <span class="op">=</span> <span class="st">"urban"</span><span class="op">)</span>,</span>
<span>  code_label <span class="op">=</span> <span class="st">"manual_partition"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">qs2</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/manual_parts/country=USA/reporting_level=urban/year=2024/part.qs2</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">54cf7f448afa1a1c</span></span></span>
<span></span>
<span><span class="co"># Get expected path for a partition</span></span>
<span><span class="va">expected_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_part_path.html">st_part_path</a></span><span class="op">(</span></span>
<span>  base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"manual_parts"</span><span class="op">)</span>,</span>
<span>  key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"USA"</span>, year <span class="op">=</span> <span class="fl">2024</span>, reporting_level <span class="op">=</span> <span class="st">"urban"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Expected path:\n"</span>, <span class="va">expected_path</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Expected path:</span></span>
<span><span class="co">#&gt;  /tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/manual_parts/country=USA/reporting_level=urban/year=2024/part.qs2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">expected_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="primary-keys-and-partitions">Primary Keys and Partitions<a class="anchor" aria-label="anchor" href="#primary-keys-and-partitions"></a>
</h2>
<p>Combine partitioning with primary key validation:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define primary key spanning partition columns</span></span>
<span><span class="va">pk_manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">welfare</span>,</span>
<span>  base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"welfare_pk"</span><span class="op">)</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>  pk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span>, <span class="st">"hh_id"</span><span class="op">)</span>,</span>
<span>  unique <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Enforce uniqueness</span></span>
<span>  .progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=USA/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">73fcbac7014eab2d</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=USA/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">2307dd089549ff5c</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=USA/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">21872ce08d67cfbf</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=USA/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">cf9eee17858bbcc6</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=USA/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">b0c4ffaf1fa5de01</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=CAN/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">f2867577c7e35867</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=CAN/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">fe86f2c6cb3b27c6</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=CAN/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">076e661b0e8a175f</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=CAN/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">1da9bea244c897d1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=CAN/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">a3926267476de2c1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=MEX/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8eab03899b81720a</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=MEX/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">d8a27e176116e90f</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=MEX/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">1b1d11a0834007fe</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=MEX/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">6bf635a21e9e7ad1</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk/country=MEX/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8979ddf0d5b1098d</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 15 partitions to</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_pk</span></span></span>
<span></span>
<span><span class="co"># Each partition file has PK validation in sidecar metadata</span></span></code></pre></div>
<p>When <code>unique = TRUE</code>: - Validates PK uniqueness
<strong>within each partition file</strong> - Stores PK definition in
sidecar metadata - Fails save if duplicates found</p>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-partitioning">When to Use Partitioning<a class="anchor" aria-label="anchor" href="#when-to-use-partitioning"></a>
</h3>
<p><strong>Good for:</strong> - Datasets &gt; 100MB with natural
groupings (country, date, category) - Workloads that frequently filter
by partition keys - Parallel/distributed processing - Incremental
updates (update only changed partitions)</p>
<p><strong>Not ideal for:</strong> - Small datasets (&lt; 10MB) -
overhead not worth it - Random access patterns across all partitions -
High cardinality partition keys (millions of unique values)</p>
</div>
<div class="section level3">
<h3 id="format-selection-1">Format Selection<a class="anchor" aria-label="anchor" href="#format-selection-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="12%">
<col width="18%">
<col width="16%">
<col width="20%">
<col width="18%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th>Format</th>
<th>Write Speed</th>
<th>Read Speed</th>
<th>Column Select</th>
<th>Compression</th>
<th>Use Case</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>parquet</td>
<td>Medium</td>
<td>Fast</td>
<td>✅ Yes</td>
<td>Excellent</td>
<td>
<strong>Default</strong> - best all-around for analytics</td>
</tr>
<tr class="even">
<td>fst</td>
<td>Very Fast</td>
<td>Very Fast</td>
<td>✅ Yes</td>
<td>Good</td>
<td>High-speed iteration, frequent updates</td>
</tr>
<tr class="odd">
<td>qs2</td>
<td>Fast</td>
<td>Fast</td>
<td>❌ No</td>
<td>Excellent</td>
<td>R-specific objects, complex structures</td>
</tr>
<tr class="even">
<td>rds</td>
<td>Slow</td>
<td>Slow</td>
<td>❌ No</td>
<td>Medium</td>
<td>Small files, maximum compatibility</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation</strong>: Use <strong>parquet</strong>
(default) unless you have specific needs.</p>
</div>
<div class="section level3">
<h3 id="partition-key-selection">Partition Key Selection<a class="anchor" aria-label="anchor" href="#partition-key-selection"></a>
</h3>
<p>Choose partition keys that:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Match your query patterns</strong>: If you always filter by
country, make it a partition key</li>
<li>
<strong>Have moderate cardinality</strong>: 10-1000 unique values
ideal per key</li>
<li>
<strong>Create balanced partitions</strong>: Avoid one huge
partition + many tiny ones</li>
<li>
<strong>Are immutable</strong>: Values shouldn’t change over
time</li>
</ol>
<p><strong>Example - Good:</strong></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">partitioning</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"quarter"</span><span class="op">)</span>  <span class="co"># 195 countries × 10 years × 4 quarters = ~8K partitions</span></span></code></pre></div>
<p><strong>Example - Bad:</strong></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">partitioning</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"user_id"</span>, <span class="st">"timestamp"</span><span class="op">)</span>  <span class="co"># Millions of users × millions of timestamps = too many!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="memory-optimization">Memory Optimization<a class="anchor" aria-label="anchor" href="#memory-optimization"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bad: Load everything then filter in R</span></span>
<span><span class="co"># all_data &lt;- st_load_parts(parts_dir)</span></span>
<span><span class="co"># usa_data &lt;- all_data[country == "USA"]  # ❌ Wasteful</span></span>
<span></span>
<span><span class="co"># Good: Filter partitions before loading</span></span>
<span><span class="va">usa_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"USA"</span> <span class="co"># ✅ Only loads USA partitions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2020/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2020/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2021/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span></span>
<span><span class="co"># Better: Also select columns</span></span>
<span><span class="va">usa_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"USA"</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span><span class="op">)</span> <span class="co"># ✅ Only loads USA partitions, income column</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-patterns">Advanced Patterns<a class="anchor" aria-label="anchor" href="#advanced-patterns"></a>
</h2>
<div class="section level3">
<h3 id="incremental-updates">Incremental Updates<a class="anchor" aria-label="anchor" href="#incremental-updates"></a>
</h3>
<p>Update only specific partitions:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># New data for USA 2024 only</span></span>
<span><span class="va">new_usa_2024</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="st">"USA"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2024</span>,</span>
<span>  reporting_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"national"</span>, <span class="st">"urban"</span><span class="op">)</span>,</span>
<span>  hh_id <span class="op">=</span> <span class="fl">1001</span><span class="op">:</span><span class="fl">1002</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60000</span>, <span class="fl">55000</span><span class="op">)</span>,</span>
<span>  consumption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40000</span>, <span class="fl">38000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overwrite just the USA 2024 partitions</span></span>
<span><span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">new_usa_2024</span>,</span>
<span>  base <span class="op">=</span> <span class="va">parts_dir</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"reporting_level"</span><span class="op">)</span>,</span>
<span>  code_label <span class="op">=</span> <span class="st">"incremental_update"</span>,</span>
<span>  .progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">435d998d25becd6b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">2036d10ef571570a</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 2 partitions to</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts</span></span></span>
<span></span>
<span><span class="co"># Other partitions remain unchanged</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="processing-pipeline">Processing Pipeline<a class="anchor" aria-label="anchor" href="#processing-pipeline"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. List partitions matching criteria</span></span>
<span><span class="va">target_partitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_list_parts.html">st_list_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2022</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Processing %d partitions...\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">target_partitions</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Processing 27 partitions...</span></span>
<span></span>
<span><span class="co"># 2. Load filtered data</span></span>
<span><span class="va">recent_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_parts.html">st_load_parts</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  filter <span class="op">=</span> <span class="op">~</span> <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2022</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"dt"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=CAN/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=MEX/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=national/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=rural/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt; Warning: No primary key recorded for</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">parquet</span>] ←</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/welfare_parts/country=USA/reporting_level=urban/year=2024/part.parquet</span></span></span>
<span></span>
<span><span class="co"># 3. Process (compute ratio from income and consumption) - only if columns exist</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"income"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="st">"consumption"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">recent_data</span><span class="op">[</span>, <span class="va">income_ratio</span> <span class="op">:=</span> <span class="va">income</span> <span class="op">/</span> <span class="va">consumption</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Keep only needed columns for output</span></span>
<span>  <span class="va">cols_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"income"</span>, <span class="st">"consumption"</span>, <span class="st">"income_ratio"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">recent_data</span> <span class="op">&lt;-</span> <span class="va">recent_data</span><span class="op">[</span>, <span class="va">..cols_to_keep</span><span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Note: income or consumption columns not available in loaded data\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 4. Save results to new partition set (only if we have processed data)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">recent_data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/st_write_parts.html">st_write_parts</a></span><span class="op">(</span></span>
<span>    <span class="va">recent_data</span>,</span>
<span>    base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"processed_welfare"</span><span class="op">)</span>,</span>
<span>    partitioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>    code_label <span class="op">=</span> <span class="st">"computed_ratios"</span>,</span>
<span>    .progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=CAN/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">1550c0295a0540e2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=CAN/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">2df47e87d98e7820</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=CAN/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">d02e139cd063f7f7</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=MEX/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">a04461541797b3fc</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=MEX/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">a52e2adbd8a20e5c</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=MEX/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">efff97768dd45bdf</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=USA/year=2022/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">8b1f6380849db19c</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=USA/year=2023/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">35c4715ed8b71d4b</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">parquet</span>] →</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare/country=USA/year=2024/part.parquet</span></span></span>
<span><span class="co">#&gt;   @ version <span style="color: #00BB00;">470730be237b7d3d</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Saved 9 partitions to</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">/tmp/RtmpANskQE/stamp-partitions-21124c49c0ea/processed_welfare</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-arrowduckdb">Comparison with Arrow/DuckDB<a class="anchor" aria-label="anchor" href="#comparison-with-arrowduckdb"></a>
</h2>
<p>stamp partitions are compatible with other tools:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stamp partitions can be read by Arrow</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">open_dataset</a></span><span class="op">(</span></span>
<span>  <span class="va">parts_dir</span>,</span>
<span>  partitioning <span class="op">=</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/schema.html" class="external-link">schema</a></span><span class="op">(</span></span>
<span>    country <span class="op">=</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">string</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">int32</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    reporting_level <span class="op">=</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/data-type.html" class="external-link">string</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2021</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">income</span>, <span class="va">consumption</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or DuckDB</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">duckdb</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">dbGetQuery</span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT * FROM read_parquet('%s/**/*.parquet')"</span>, <span class="va">parts_dir</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Differences:</p>
<table class="table">
<colgroup>
<col width="29%">
<col width="22%">
<col width="22%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>stamp</th>
<th>Arrow</th>
<th>DuckDB</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Format control</td>
<td>✅ Multiple formats</td>
<td>Parquet focus</td>
<td>Multiple formats</td>
</tr>
<tr class="even">
<td>Versioning</td>
<td>✅ Built-in</td>
<td>❌ None</td>
<td>❌ None</td>
</tr>
<tr class="odd">
<td>Lineage</td>
<td>✅ Tracked</td>
<td>❌ None</td>
<td>❌ None</td>
</tr>
<tr class="even">
<td>R integration</td>
<td>✅ Native</td>
<td>Good</td>
<td>Good</td>
</tr>
<tr class="odd">
<td>Query engine</td>
<td>Basic filtering</td>
<td>Advanced SQL</td>
<td>Full SQL</td>
</tr>
<tr class="even">
<td>Dependencies</td>
<td>Lightweight</td>
<td>Heavy (C++)</td>
<td>Heavy (C++)</td>
</tr>
</tbody>
</table>
<p><strong>Use stamp when:</strong> - You need versioning and lineage
tracking - You want lightweight dependencies - You’re primarily working
in R</p>
<p><strong>Use Arrow/DuckDB when:</strong> - You need advanced query
capabilities - You’re working with multi-language teams - Dataset size
exceeds memory (lazy evaluation needed)</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Key takeaways:</p>
<ol style="list-style-type: decimal">
<li>
<strong><code><a href="../reference/st_write_parts.html">st_write_parts()</a></code></strong>: Auto-partition
datasets (eliminates manual loops)</li>
<li>
<strong>Hive-style paths</strong>:
<code>key1=value1/key2=value2/file.ext</code> (self-documenting)</li>
<li>
<strong>Two filter modes</strong>:
<ul>
<li>Named list: <code>filter = list(country = "USA")</code> (exact
match)</li>
<li>Formula: <code>filter = ~ year &gt; 2021</code> (flexible
expressions)</li>
</ul>
</li>
<li>
<strong>Column selection</strong>:
<code>columns = c("col1", "col2")</code> (native for parquet/fst)</li>
<li>
<strong>Default format</strong>: Parquet (optimal for
analytics)</li>
<li>
<strong>Partition discovery</strong>: <code><a href="../reference/st_list_parts.html">st_list_parts()</a></code>
(inventory without loading)</li>
</ol>
<p>Next steps: - See <code><a href="../articles/hashing-and-versions.html">vignette("hashing-and-versions")</a></code> for
versioning details - See <code><a href="../articles/lineage-rebuilds.html">vignette("lineage-rebuilds")</a></code> for
dependency tracking - See <code><a href="../reference/st_write_parts.html">?st_write_parts</a></code> for full API
documentation</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by R.Andres Castaneda, Diana C. Garcia Rojas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
