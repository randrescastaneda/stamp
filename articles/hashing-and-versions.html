<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hashing, Change Detection and Versions • stamp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hashing, Change Detection and Versions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stamp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/stamp.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/setup-and-basics.html">Setup and Basics</a></li>
    <li><a class="dropdown-item" href="../articles/hashing-and-versions.html">Hashing, Change Detection and Versions</a></li>
    <li><a class="dropdown-item" href="../articles/lineage-rebuilds.html">Lineage and Rebuilds</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Usage</h6></li>
    <li><a class="dropdown-item" href="../articles/builders-plans.html">Builders, Plans, and Rebuilds</a></li>
    <li><a class="dropdown-item" href="../articles/version_retention_prune.html">Version Retention, Pruning, and Table Metadata</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/randrescastaneda/stamp"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hashing, Change Detection and Versions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/randrescastaneda/stamp/blob/master/vignettes/hashing-and-versions.Rmd" class="external-link"><code>vignettes/hashing-and-versions.Rmd</code></a></small>
      <div class="d-none name"><code>hashing-and-versions.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use development build when interactive *and* explicitly enabled via env var.</span></span>
<span><span class="va">dev_mode</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DEV_VIGNETTES"</span>, <span class="st">"false"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"true"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">dev_mode</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"pkgload"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">pkgload</span><span class="fu">::</span><span class="fu"><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span></span>
<span>    export_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    helpers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    attach_testthat <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># fall back to the installed package (the path CRAN, CI, and pkgdown take)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://randrescastaneda.github.io/stamp/">stamp</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This article explains how stamp detects changes and records versions.
We’ll cover:</p>
<ul>
<li>Stable object hashing (<code><a href="../reference/st_hash_obj.html">st_hash_obj()</a></code>),</li>
<li>Code hashing / provenance (<code><a href="../reference/st_hash_code.html">st_hash_code()</a></code>),</li>
<li>Optional file hashing (<code><a href="../reference/st_hash_file.html">st_hash_file()</a></code>),</li>
<li>Change-detection helpers (<code><a href="../reference/st_changed.html">st_changed()</a></code>,
<code><a href="../reference/st_changed_reason.html">st_changed_reason()</a></code>, <code><a href="../reference/st_should_save.html">st_should_save()</a></code>),
and</li>
<li>The lightweight versions catalog (<code><a href="../reference/st_versions.html">st_versions()</a></code>,
<code><a href="../reference/st_latest.html">st_latest()</a></code>, <code><a href="../reference/st_load_version.html">st_load_version()</a></code>).</li>
</ul>
<p>The core idea: stamp computes stable, reproducible hashes for objects
and (optionally) the user-supplied code. When you call
<code><a href="../reference/st_save.html">st_save()</a></code>, stamp compares the new hashes with stored
metadata (sidecars or committed snapshots) and decides whether to write
a new version. This allows cheap “skip-on-equal” behavior for expensive
workflows.</p>
<div class="section level2">
<h2 id="recommended-options">Recommended options<a class="anchor" aria-label="anchor" href="#recommended-options"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_opts_reset.html">st_opts_reset</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/st_opts.html">st_opts</a></span><span class="op">(</span></span>
<span>  versioning <span class="op">=</span> <span class="st">"content"</span>, <span class="co"># skip write when content unchanged</span></span>
<span>  code_hash <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># store code hash when 'code=' is provided to st_save()</span></span>
<span>  store_file_hash <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># compute &amp; store file hash after write</span></span>
<span>  verify_on_load <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># verify content on load (warn on mismatch)</span></span>
<span>  meta_format <span class="op">=</span> <span class="st">"both"</span> <span class="co"># write JSON + QS2 sidecars</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> stamp options updated</span></span>
<span><span class="co">##   versioning = <span style="color: #0000BB;">"content"</span>, code_hash = <span style="color: #0000BB;">"TRUE"</span>, store_file_hash = <span style="color: #0000BB;">"TRUE"</span>,</span></span>
<span><span class="co">##   verify_on_load = <span style="color: #0000BB;">"TRUE"</span>, meta_format = <span style="color: #0000BB;">"both"</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="save-with-hashes-and-skip-if-content-identical">Save with hashes (and skip if content identical)<a class="anchor" aria-label="anchor" href="#save-with-hashes-and-skip-if-content-identical"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/st_init.html">st_init</a></span><span class="op">(</span><span class="va">root</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> stamp initialized</span></span>
<span><span class="co">##   root: /tmp/RtmpbuSJ0M</span></span>
<span><span class="co">##   state: /tmp/RtmpbuSJ0M/.stamp</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">root</span>, <span class="st">"demo.qs"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First write: creates artifact + sidecars + catalog entry</span></span>
<span><span class="fu"><a href="../reference/st_save.html">st_save</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">p</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">qs2</span>] → <span style="color: #0000BB;">/tmp/RtmpbuSJ0M/demo.qs</span> @</span></span>
<span><span class="co">## version <span style="color: #00BB00;">aa32ca8c8fc51698</span></span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Second write, same content &amp; same code: skipped (no new version)</span></span>
<span><span class="fu"><a href="../reference/st_save.html">st_save</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">p</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Skip save (reason: <span style="color: #00BB00;">no_change_policy</span>) for</span></span>
<span><span class="co">## <span style="color: #0000BB;">/tmp/RtmpbuSJ0M/demo.qs</span></span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_versions.html">st_versions</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># should be 1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<p>In the snippet above stamp serializes <code>x</code> in a
deterministic way and computes a content hash. If both the content hash
and (when provided) the code hash match the stored metadata, no new
version is created when <code>versioning = "content"</code>.</p>
<p>Note: the first write will always create the artifact and its
sidecar(s). If you see the first write skipped, check that the path you
passed to <code><a href="../reference/st_save.html">st_save()</a></code> exactly matches subsequent calls.</p>
<p>If you <strong>change content</strong> (or <strong>change the
code</strong>), a new version is recorded:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">x</span>, a <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/st_save.html">st_save</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">p</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">qs2</span>] → <span style="color: #0000BB;">/tmp/RtmpbuSJ0M/demo.qs</span> @</span></span>
<span><span class="co">## version <span style="color: #00BB00;">9aafb21a10646ab3</span></span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_versions.html">st_versions</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># now 2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_latest.html">st_latest</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="co"># latest version id (string)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "9aafb21a10646ab3"</span></span></code></pre>
<blockquote>
<p><strong>Policy:</strong> By design, changing the <code>code=</code>
you pass to <code><a href="../reference/st_save.html">st_save()</a></code> creates a new version even if
<code>x</code> is identical. This makes code provenance explicit.</p>
</blockquote>
<p>A short practical pattern:</p>
<ul>
<li>Pass your transformation code to
<code>st_save(..., code = &lt;function or expression&gt;)</code> so
stamp can record the code hash.</li>
<li>Use <code><a href="../reference/st_changed.html">st_changed()</a></code> or <code><a href="../reference/st_should_save.html">st_should_save()</a></code> to
cheaply decide whether to run expensive computations before calling
<code><a href="../reference/st_save.html">st_save()</a></code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="inspect-sidecars-metadata">Inspect sidecars &amp; metadata<a class="anchor" aria-label="anchor" href="#inspect-sidecars-metadata"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_read_sidecar.html">st_read_sidecar</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"format"</span>,</span>
<span>  <span class="st">"created_at"</span>,</span>
<span>  <span class="st">"size_bytes"</span>,</span>
<span>  <span class="st">"content_hash"</span>,</span>
<span>  <span class="st">"code_hash"</span>,</span>
<span>  <span class="st">"file_hash"</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $format</span></span>
<span><span class="co">## [1] "qs2"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $created_at</span></span>
<span><span class="co">## [1] "2025-11-24T19:24:39Z"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $size_bytes</span></span>
<span><span class="co">## [1] 195</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $content_hash</span></span>
<span><span class="co">## [1] "7e25cdd35cd37239"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $code_hash</span></span>
<span><span class="co">## [1] "488e8fa49c740261"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $file_hash</span></span>
<span><span class="co">## [1] "50ed8c23167ce3ac"</span></span></code></pre>
<p>Explanation:</p>
<ul>
<li><p><code>content_hash</code> is the stable hash of the R object
written (via <code><a href="../reference/st_hash_obj.html">st_hash_obj()</a></code>).</p></li>
<li><p><code>code_hash</code> is recorded when you provide
<code>code=</code> to <code><a href="../reference/st_save.html">st_save()</a></code> (via
<code><a href="../reference/st_hash_code.html">st_hash_code()</a></code>).</p></li>
<li><p><code>file_hash</code> is computed after the file write (if
<code>store_file_hash = TRUE</code>) and can be used to detect external
file tampering.</p></li>
<li><p><code>content_hash</code> comes from
<code>st_hash_obj(x)</code></p></li>
<li><p><code>code_hash</code> comes from <code>st_hash_code(code)</code>
if you supplied <code>code=</code></p></li>
<li><p><code>file_hash</code> is optional (post-write) and is used to
verify on load</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="change-detection-without-writing">Change detection (without writing)<a class="anchor" aria-label="anchor" href="#change-detection-without-writing"></a>
</h2>
<p>Use these <strong>before</strong> doing expensive work, to decide
whether to recompute.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_same</span> <span class="op">&lt;-</span> <span class="va">x2</span></span>
<span><span class="va">x_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">x2</span>, a <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">10L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/st_changed.html">st_changed</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">x_same</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $changed</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $reason</span></span>
<span><span class="co">## [1] "no_change"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $details</span></span>
<span><span class="co">## $details$content_changed</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $details$code_changed</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $details$file_changed</span></span>
<span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_changed_reason.html">st_changed_reason</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">x_same</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span> <span class="co"># "no_change"</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "no_change"</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_changed.html">st_changed</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">x_new</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $changed</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $reason</span></span>
<span><span class="co">## [1] "content"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $details</span></span>
<span><span class="co">## $details$content_changed</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $details$code_changed</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $details$file_changed</span></span>
<span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_changed_reason.html">st_changed_reason</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">x_new</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span> <span class="co"># "content"</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "content"</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_should_save.html">st_should_save</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">x_same</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span> <span class="co"># recommends skip</span></span></code></pre></div>
<pre><code><span><span class="co">## $save</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $reason</span></span>
<span><span class="co">## [1] "no_change_policy"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/st_should_save.html">st_should_save</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">x_new</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span> <span class="co"># recommends save</span></span></code></pre></div>
<pre><code><span><span class="co">## $save</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $reason</span></span>
<span><span class="co">## [1] "content"</span></span></code></pre>
<p>When you call <code><a href="../reference/st_changed.html">st_changed()</a></code> or
<code><a href="../reference/st_changed_reason.html">st_changed_reason()</a></code> you avoid performing any file writes.
These helpers are ideal as guards inside functions that compute
expensive results only when necessary:</p>
<p>Example pattern inside your pipeline function:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/st_should_save.html">st_should_save</a></span><span class="op">(</span><span class="va">p</span>, x <span class="op">=</span> <span class="va">out</span>, code <span class="op">=</span> <span class="va">my_transform</span><span class="op">)</span><span class="op">$</span><span class="va">save</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/st_save.html">st_save</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">p</span>, code <span class="op">=</span> <span class="va">my_transform</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Skipping write; content and code unchanged"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-specific-versions">Loading specific versions<a class="anchor" aria-label="anchor" href="#loading-specific-versions"></a>
</h2>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_versions.html">st_versions</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">vids</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          version_id      artifact_id     content_hash        code_hash</span></span>
<span><span class="co">##              &lt;char&gt;           &lt;char&gt;           &lt;char&gt;           &lt;char&gt;</span></span>
<span><span class="co">## 1: aa32ca8c8fc51698 811958ff45e99a52 1811ba4b2bd2a26a 488e8fa49c740261</span></span>
<span><span class="co">## 2: 9aafb21a10646ab3 811958ff45e99a52 7e25cdd35cd37239 488e8fa49c740261</span></span>
<span><span class="co">##    size_bytes           created_at sidecar_format</span></span>
<span><span class="co">##         &lt;num&gt;               &lt;char&gt;         &lt;char&gt;</span></span>
<span><span class="co">## 1:        244 2025-11-24T19:24:39Z           both</span></span>
<span><span class="co">## 2:        195 2025-11-24T19:24:39Z           both</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vid_latest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_latest.html">st_latest</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">obj_latest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_version.html">st_load_version</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">vid_latest</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Loaded ← <span style="color: #00BB00;">/tmp/RtmpbuSJ0M/demo.qs</span> @</span></span>
<span><span class="co">## <span style="color: #00BB00;">9aafb21a10646ab3</span> [<span style="color: #00BB00;">qs2</span>]</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load an older version by id</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vids</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vid_old</span> <span class="op">&lt;-</span> <span class="va">vids</span><span class="op">$</span><span class="va">version_id</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vids</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">obj_old</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/st_load_version.html">st_load_version</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">vid_old</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Loaded ← <span style="color: #00BB00;">/tmp/RtmpbuSJ0M/demo.qs</span> @</span></span>
<span><span class="co">## <span style="color: #00BB00;">9aafb21a10646ab3</span> [<span style="color: #00BB00;">qs2</span>]</span></span></code></pre>
<p><code><a href="../reference/st_versions.html">st_versions()</a></code> returns a table of version metadata. Each
row includes the <code>version_id</code>, <code>created_at</code>, and a
snapshot of sidecar fields available at commit time. Use
<code><a href="../reference/st_load_version.html">st_load_version()</a></code> to restore the artifact as it was at that
version.</p>
<div class="section level3">
<h3 id="where-are-versions-stored">Where are versions stored?<a class="anchor" aria-label="anchor" href="#where-are-versions-stored"></a>
</h3>
<p>Snapshots live under
<code>.stamp/versions/&lt;relative-path&gt;/&lt;version_id&gt;/</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">root</span>, <span class="st">"demo.qs"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write once to create a version snapshot</span></span>
<span><span class="fu"><a href="../reference/st_save.html">st_save</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">p</span>, code <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Saved [<span style="color: #00BB00;">qs2</span>] → <span style="color: #0000BB;">/tmp/RtmpbuSJ0M/demo.qs</span> @</span></span>
<span><span class="co">## version <span style="color: #00BB00;">a161434dd00a299c</span></span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now list the versions tree</span></span>
<span><span class="va">vroot</span> <span class="op">&lt;-</span> <span class="fu">stamp</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-st_versions_root.html">.st_versions_root</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">vroot</span>, recurse <span class="op">=</span> <span class="cn">TRUE</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #0000BB; font-weight: bold;">/tmp/RtmpbuSJ0M/.stamp/versions</span></span></span>
<span><span class="co">## └── <span style="color: #0000BB; font-weight: bold;">demo.qs</span></span></span>
<span><span class="co">##     ├── <span style="color: #0000BB; font-weight: bold;">9aafb21a10646ab3</span></span></span>
<span><span class="co">##     │   ├── artifact</span></span>
<span><span class="co">##     │   ├── sidecar.json</span></span>
<span><span class="co">##     │   └── sidecar.qs2</span></span>
<span><span class="co">##     ├── <span style="color: #0000BB; font-weight: bold;">a161434dd00a299c</span></span></span>
<span><span class="co">##     │   ├── artifact</span></span>
<span><span class="co">##     │   ├── sidecar.json</span></span>
<span><span class="co">##     │   └── sidecar.qs2</span></span>
<span><span class="co">##     └── <span style="color: #0000BB; font-weight: bold;">aa32ca8c8fc51698</span></span></span>
<span><span class="co">##         ├── artifact</span></span>
<span><span class="co">##         ├── sidecar.json</span></span>
<span><span class="co">##         └── sidecar.qs2</span></span></code></pre>
<p>Each snapshot dir contains:</p>
<ul>
<li>
<code>artifact</code> — a copy of the saved file</li>
<li>
<code>sidecar.json</code> and/or <code>sidecar.qs2</code> —
depending on <code>meta_format</code>
</li>
</ul>
<p>Additionally each snapshot may include a <code>parents.json</code>
file capturing committed lineage between artifacts; this is created when
stamp records explicit parents during a commit. Sidecar metadata (in
<code>stmeta/</code>) is the primary local source used to decide whether
to write, while snapshots are the long-term committed record.</p>
</div>
</div>
<div class="section level2">
<h2 id="integrity-checks-on-load-optional">Integrity checks on load (optional)<a class="anchor" aria-label="anchor" href="#integrity-checks-on-load-optional"></a>
</h2>
<p>If <code>verify_on_load = TRUE</code> and a <code>content_hash</code>
exists in the sidecar, <code><a href="../reference/st_load.html">st_load()</a></code> recomputes the object’s
hash and warns if it differs (indicating the file changed outside
<strong>stamp</strong>).</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_load.html">st_load</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># triggers optional verify; warns on mismatch</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: No primary key recorded for <span style="color: #0000BB;">/tmp/RtmpbuSJ0M/demo.qs</span>.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> You can add one with `st_add_pk()`.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Loaded [<span style="color: #00BB00;">qs2</span>] ← <span style="color: #0000BB;">/tmp/RtmpbuSJ0M/demo.qs</span></span></span></code></pre>
<p>If <code>verify_on_load = TRUE</code>, <code><a href="../reference/st_load.html">st_load()</a></code>
recomputes <code><a href="../reference/st_hash_obj.html">st_hash_obj()</a></code> and compares it to the
<code>content_hash</code> recorded in the sidecar or snapshot. A
mismatch usually means the file was modified outside of stamp and
re-saving is recommended.</p>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<p><strong>Q: The first <code><a href="../reference/st_save.html">st_save()</a></code> was skipped and
<code>st_versions(p)</code> is 0.</strong> A: The first write should
<strong>never</strong> be skipped. Ensure you’re using the current
<code><a href="../reference/st_should_save.html">st_should_save()</a></code> which returns <code>save = TRUE</code>
when the artifact is missing or the sidecar is missing.</p>
<p><strong>Q: <code><a href="../reference/st_changed_reason.html">st_changed_reason()</a></code> says
<code>"missing_meta"</code>.</strong> A: The artifact exists but the
sidecar was removed or is unreadable. Call
<code>st_save(x, p, code = ...)</code> once; it will re-materialize
metadata and record a version.</p>
<p><strong>Q: Changing only <code>code=</code> didn’t create a new
version.</strong> A: By design, a code change <strong>does</strong>
create a new version. Confirm
<code>st_opts("code_hash", .get = TRUE)</code> is <code>TRUE</code> and
you passed <code>code=</code> consistently (e.g., a function literal,
not different object pointers to identical functions in rare cases).</p>
<p><strong>Q: CSV round-trips aren’t byte-identical.</strong> A:
<code>data.table::fread/fwrite</code> may coerce types (e.g., integers
vs doubles). Compare with relaxed checks or coerce types before
comparison.</p>
<p><strong>Q: I see a warning on load about hash mismatch.</strong> A:
With <code>verify_on_load = TRUE</code>, <strong>stamp</strong>
recomputes the object hash and warns if it differs from the sidecar’s
<code>content_hash</code>. This indicates the file was modified outside
<strong>stamp</strong> or the sidecar is stale. Re-save to repair.</p>
<p><strong>Q: <code>qs2</code> isn’t installed.</strong> A:
<code>qs2</code> is preferred. If unavailable, <strong>stamp</strong>
falls back to <a href="https://github.com/qsbase/qs" class="external-link">qs</a> for read/write under the
<code>"qs2"</code> handler. Install <a href="https://github.com/qsbase/qs2" class="external-link">qs2</a> for best
performance.</p>
<p><strong>Q: Sidecars not appearing.</strong> A: Check
<code>st_opts("meta_format", .get = TRUE)</code> — set to
<code>"json"</code>, <code>"qs2"</code>, or <code>"both"</code>.
Sidecars are written to <code>stmeta/</code> next to the artifact.</p>
<p><strong>Q: Versions aren’t where I expect.</strong> A: Version
snapshots live under
<code>.stamp/versions/&lt;relative-path&gt;/&lt;version_id&gt;/</code>.
Use the code snippet above to explore the tree.</p>
</div>
<div class="section level2">
<h2 id="tips-conventions">Tips &amp; conventions<a class="anchor" aria-label="anchor" href="#tips-conventions"></a>
</h2>
<ul>
<li>Keep <code>versioning = "content"</code> for reproducible artifacts;
use <code>"timestamp"</code> if you want a new version on every save;
<code>"off"</code> to skip versioning entirely.</li>
<li>Use <code><a href="../reference/st_changed.html">st_changed()</a></code> / <code><a href="../reference/st_should_save.html">st_should_save()</a></code> to
gate expensive computation inside your own functions.</li>
<li>Sidecars: prefer <code>meta_format = "json"</code> for readability,
<code>"qs2"</code> for compactness, or <code>"both"</code> for
redundancy.</li>
</ul>
<p>Further reading / next steps:</p>
<ul>
<li>See the <code>lineage-rebuilds</code> vignette for how committed
<code>parents</code> and sidecar parents interact during
<code><a href="../reference/st_rebuild.html">st_rebuild()</a></code>.</li>
<li>Consider recording <code>code=</code> for critical data
transformations so provenance is preserved even when object content is
identical.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by R.Andres Castaneda.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
