% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hashing.R
\name{st_normalize_attrs}
\alias{st_normalize_attrs}
\title{Normalize attributes for consistent hashing}
\usage{
st_normalize_attrs(x)
}
\arguments{
\item{x}{A data.frame, data.table, list, or other object.}
}
\value{
A new object with the same data but attributes in canonical order.
The class is preserved.
}
\description{
Normalizes the order of object attributes to a canonical form by creating
a new object with attributes in the correct order. This is necessary because
R does not allow reordering attributes in-place.
}
\section{Problem}{

Operations like \code{collapse::rowbind()} + \code{collapse::funique()} can leave
attributes in different orders even when content is identical. Since
\code{serialize()} includes attribute order, this causes different byte streams
and thus different hashes for logically identical objects.
}

\section{Solution}{

This function reorders attributes to a canonical order:
\enumerate{
\item Priority attributes: names, row.names, class, .internal.selfref
\item Additional attributes: alphabetically sorted
}
}

\section{Implementation Strategy}{

The function creates a new object with attributes in canonical order.
This is a shallow copy - the actual data (columns, elements) is referenced,
not copied, making it efficient even for large objects.

\strong{For data.table objects:}
\itemize{
\item Extracts columns as a list
\item Rebuilds with attributes in canonical order
\item Shallow copy (column data is referenced, not duplicated)
\item Preserves data.table class and .internal.selfref
}

\strong{For regular data.frames:}
\itemize{
\item Rebuilds from column list with canonical attribute order
\item Shallow copy (column data is referenced, not copied)
\item Preserves data.frame class
}

\strong{For lists and other objects:}
\itemize{
\item Uses \code{unclass()} + attribute replacement
\item Shallow copy when possible
}
}

\section{Performance}{

\itemize{
\item Shallow copy strategy: data is referenced, not duplicated
\item Fast path: returns unchanged if already in canonical order
\item Negligible overhead for most use cases (< 1\% of hashing time)
}
}

\keyword{internal}
