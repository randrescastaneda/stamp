---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# stamp

<!-- badges: start -->
[![Codecov test coverage](https://codecov.io/gh/randrescastaneda/stamp/branch/master/graph/badge.svg)](https://app.codecov.io/gh/randrescastaneda/stamp?branch=master)
<!-- badges: end -->

Lightweight versioned artifact store for R with sidecar metadata, pruning policies,
and Hive-style partitions.


## Installation

You can install the development version of stamp from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("randrescastaneda/stamp")
```

## Quickstart

```{r}
library(stamp)
root <- tempdir()
st_init(root)

p <- fs::path(root, "demo.qs")
x <- data.frame(id = 1:3, val = letters[1:3])

st_save(x, p, pk = "id", code = function(z) z)
y <- st_load(p)
st_versions(p)

# Retention
st_opts(retain_versions = 2)
st_save(transform(x, val = toupper(val)), p, code = function(z) z)
st_versions(p)

# Partitions
base <- fs::path(root, "inputs/country_year")
st_save_part(
  data.frame(country = "PER", year = 2023, pop = 34.5),
  base,
  key = list(country = "PER", year = 2023),
  pk = c("country", "year")
)
st_list_parts(base)
st_load_parts(base, as = "rbind")
```

Why stamp?
Sidecars: hashes, provenance, PKs.

Retention: keep latest N and/or recent days.

Partitions: Hive-style directories, easy bind & filter.

See vignettes for retention + partition details.